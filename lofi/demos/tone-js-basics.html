<!DOCTYPE html>
<html>
<head>
  <title>Tone.js Basics - Demo</title>
  <script src="https://unpkg.com/tone@14"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { color: #e94560; margin-bottom: 10px; }
    h2 { color: #4ecdc4; margin-top: 30px; }
    .subtitle { color: #888; margin-bottom: 30px; }

    .section {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }

    .control {
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
    }
    .control label {
      display: block;
      color: #888;
      font-size: 12px;
      margin-bottom: 5px;
    }
    .control .value {
      color: #e94560;
      font-weight: bold;
      float: right;
    }
    .control input[type="range"] {
      width: 100%;
      margin-top: 5px;
    }
    .control select {
      width: 100%;
      padding: 8px;
      background: #2a2a4e;
      color: #eee;
      border: 1px solid #444;
      border-radius: 4px;
    }

    button {
      background: #e94560;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 8px;
      margin: 5px;
      transition: transform 0.1s, background 0.2s;
    }
    button:hover { background: #ff6b6b; transform: scale(1.02); }
    button:active { transform: scale(0.98); }
    button:disabled { background: #444; cursor: not-allowed; transform: none; }

    .keyboard {
      display: flex;
      gap: 5px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .key {
      background: #4ecdc4;
      color: #1a1a2e;
      border: none;
      padding: 20px 15px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.1s;
    }
    .key:hover { background: #6ee7df; transform: translateY(-2px); }
    .key:active { transform: translateY(0); }
    .key.black { background: #2a2a4e; color: #eee; padding: 15px 10px; }
    .key.black:hover { background: #3a3a6e; }

    #status {
      text-align: center;
      padding: 10px;
      color: #888;
      font-size: 14px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      margin: 10px 0;
    }

    .envelope-visual {
      height: 100px;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      margin: 15px 0;
      position: relative;
      overflow: hidden;
    }
    #envelopePath {
      fill: none;
      stroke: #e94560;
      stroke-width: 3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Tone.js Basics</h1>
    <p class="subtitle">Interactive exploration of synth fundamentals</p>

    <div class="section">
      <h2>1. Synth Types</h2>
      <p>Different oscillators produce different timbres (tone colors)</p>

      <div class="controls">
        <div class="control">
          <label>Oscillator Type</label>
          <select id="oscType">
            <option value="sine">Sine - Pure, smooth</option>
            <option value="triangle" selected>Triangle - Soft, warm</option>
            <option value="square">Square - Hollow, retro</option>
            <option value="sawtooth">Sawtooth - Bright, buzzy</option>
          </select>
        </div>
      </div>

      <div class="keyboard">
        <button class="key" data-note="C4">C</button>
        <button class="key black" data-note="C#4">C#</button>
        <button class="key" data-note="D4">D</button>
        <button class="key black" data-note="D#4">D#</button>
        <button class="key" data-note="E4">E</button>
        <button class="key" data-note="F4">F</button>
        <button class="key black" data-note="F#4">F#</button>
        <button class="key" data-note="G4">G</button>
        <button class="key black" data-note="G#4">G#</button>
        <button class="key" data-note="A4">A</button>
        <button class="key black" data-note="A#4">A#</button>
        <button class="key" data-note="B4">B</button>
        <button class="key" data-note="C5">C</button>
      </div>

      <div id="status">Click a key to play (or use keyboard: A-L)</div>
    </div>

    <div class="section">
      <h2>2. ADSR Envelope</h2>
      <p>Controls how sound evolves over time</p>

      <div class="envelope-visual">
        <svg width="100%" height="100%" viewBox="0 0 400 100" preserveAspectRatio="none">
          <path id="envelopePath" d="M 0,100 L 40,10 L 100,40 L 280,40 L 400,100"/>
        </svg>
      </div>

      <div class="controls">
        <div class="control">
          <label>Attack <span class="value" id="attackVal">0.1s</span></label>
          <input type="range" id="attack" min="0.01" max="1" step="0.01" value="0.1">
        </div>
        <div class="control">
          <label>Decay <span class="value" id="decayVal">0.3s</span></label>
          <input type="range" id="decay" min="0.01" max="1" step="0.01" value="0.3">
        </div>
        <div class="control">
          <label>Sustain <span class="value" id="sustainVal">0.5</span></label>
          <input type="range" id="sustain" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div class="control">
          <label>Release <span class="value" id="releaseVal">1.0s</span></label>
          <input type="range" id="release" min="0.1" max="3" step="0.1" value="1">
        </div>
      </div>
    </div>

    <div class="section">
      <h2>3. Loops & Transport</h2>
      <p>Repeating patterns with the built-in clock</p>

      <div class="controls">
        <div class="control">
          <label>BPM <span class="value" id="bpmVal">72</span></label>
          <input type="range" id="bpm" min="60" max="120" step="1" value="72">
        </div>
        <div class="control">
          <label>Swing <span class="value" id="swingVal">0%</span></label>
          <input type="range" id="swing" min="0" max="0.5" step="0.05" value="0">
        </div>
      </div>

      <button id="startLoop">Start Loop</button>
      <button id="stopLoop" disabled>Stop Loop</button>
    </div>
  </div>

  <script>
    let synth = null;
    let loop = null;
    let loopRunning = false;

    // Initialize synth
    function createSynth() {
      if (synth) synth.dispose();
      synth = new Tone.Synth({
        oscillator: { type: document.getElementById('oscType').value },
        envelope: {
          attack: parseFloat(document.getElementById('attack').value),
          decay: parseFloat(document.getElementById('decay').value),
          sustain: parseFloat(document.getElementById('sustain').value),
          release: parseFloat(document.getElementById('release').value)
        }
      }).toDestination();
      synth.volume.value = -6;
    }

    // Play note
    async function playNote(note) {
      await Tone.start();
      if (!synth) createSynth();
      synth.triggerAttackRelease(note, '8n');
      document.getElementById('status').textContent = `Playing ${note}`;
    }

    // Keyboard clicks
    document.querySelectorAll('.key').forEach(key => {
      key.addEventListener('click', () => playNote(key.dataset.note));
    });

    // Computer keyboard mapping
    const keyMap = {
      'a': 'C4', 'w': 'C#4', 's': 'D4', 'e': 'D#4', 'd': 'E4',
      'f': 'F4', 't': 'F#4', 'g': 'G4', 'y': 'G#4', 'h': 'A4',
      'u': 'A#4', 'j': 'B4', 'k': 'C5'
    };
    document.addEventListener('keydown', (e) => {
      if (keyMap[e.key.toLowerCase()]) {
        playNote(keyMap[e.key.toLowerCase()]);
      }
    });

    // Oscillator type change
    document.getElementById('oscType').addEventListener('change', createSynth);

    // ADSR controls
    ['attack', 'decay', 'sustain', 'release'].forEach(param => {
      const slider = document.getElementById(param);
      const display = document.getElementById(param + 'Val');
      slider.addEventListener('input', () => {
        const val = parseFloat(slider.value);
        display.textContent = param === 'sustain' ? val.toFixed(2) : val.toFixed(2) + 's';
        if (synth) synth.envelope[param] = val;
        updateEnvelopeVisual();
      });
    });

    // Envelope visualization
    function updateEnvelopeVisual() {
      const a = parseFloat(document.getElementById('attack').value);
      const d = parseFloat(document.getElementById('decay').value);
      const s = parseFloat(document.getElementById('sustain').value);
      const r = parseFloat(document.getElementById('release').value);

      // Scale to SVG coords (400 wide, 100 tall)
      const totalTime = a + d + 1 + r; // 1 sec sustain hold
      const scale = 380 / totalTime;

      const attackX = 10 + a * scale;
      const decayX = attackX + d * scale;
      const sustainX = decayX + 1 * scale;
      const releaseX = sustainX + r * scale;

      const sustainY = 10 + (1 - s) * 80; // Inverted Y

      const path = `M 10,100 L ${attackX},10 L ${decayX},${sustainY} L ${sustainX},${sustainY} L ${releaseX},100`;
      document.getElementById('envelopePath').setAttribute('d', path);
    }
    updateEnvelopeVisual();

    // BPM control
    document.getElementById('bpm').addEventListener('input', (e) => {
      document.getElementById('bpmVal').textContent = e.target.value;
      Tone.Transport.bpm.value = parseInt(e.target.value);
    });

    // Swing control
    document.getElementById('swing').addEventListener('input', (e) => {
      document.getElementById('swingVal').textContent = Math.round(e.target.value * 100) + '%';
      Tone.Transport.swing = parseFloat(e.target.value);
    });

    // Loop controls
    const notes = ['C4', 'E4', 'G4', 'B4'];
    let noteIdx = 0;

    document.getElementById('startLoop').addEventListener('click', async () => {
      await Tone.start();
      if (!synth) createSynth();

      loop = new Tone.Loop((time) => {
        synth.triggerAttackRelease(notes[noteIdx], '8n', time);
        noteIdx = (noteIdx + 1) % notes.length;
      }, '4n').start(0);

      Tone.Transport.start();
      loopRunning = true;
      document.getElementById('startLoop').disabled = true;
      document.getElementById('stopLoop').disabled = false;
      document.getElementById('status').textContent = 'Loop running...';
    });

    document.getElementById('stopLoop').addEventListener('click', () => {
      Tone.Transport.stop();
      if (loop) { loop.dispose(); loop = null; }
      noteIdx = 0;
      loopRunning = false;
      document.getElementById('startLoop').disabled = false;
      document.getElementById('stopLoop').disabled = true;
      document.getElementById('status').textContent = 'Loop stopped';
    });
  </script>
</body>
</html>
