<!DOCTYPE html>
<html>
<head>
  <title>Bass Lines - Demo</title>
  <script src="https://unpkg.com/tone@14"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { color: #e94560; margin-bottom: 10px; }
    h2 { color: #4ecdc4; margin-top: 30px; }
    .subtitle { color: #888; margin-bottom: 30px; }

    .section {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    button {
      background: #e94560;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 8px;
      margin: 5px;
      transition: transform 0.1s, background 0.2s;
    }
    button:hover { background: #ff6b6b; transform: scale(1.02); }
    button:active { transform: scale(0.98); }
    button:disabled { background: #444; cursor: not-allowed; transform: none; }
    button.secondary { background: #4ecdc4; }
    button.secondary:hover { background: #6ee7df; }
    button.active {
      background: #6ee7df;
      color: #1a1a2e;
    }

    #status {
      text-align: center;
      padding: 10px;
      color: #888;
      font-size: 14px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      margin: 10px 0;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 15px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .control {
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .control label {
      color: #888;
      font-size: 12px;
      min-width: 60px;
    }
    .control .value {
      color: #e94560;
      font-weight: bold;
      min-width: 60px;
      text-align: right;
    }
    .control input[type="range"] {
      width: 120px;
      accent-color: #e94560;
    }

    .transport-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }

    .play-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .play-btn.playing { background: #4ecdc4; }

    /* Pattern selector */
    .pattern-selector {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 15px 0;
    }
    .pattern-btn {
      background: rgba(78, 205, 196, 0.2);
      border: 1px solid #4ecdc4;
      color: #4ecdc4;
      padding: 10px 20px;
      font-size: 14px;
    }
    .pattern-btn:hover { background: rgba(78, 205, 196, 0.3); }
    .pattern-btn.active {
      background: #4ecdc4;
      color: #1a1a2e;
    }

    /* Toggle buttons */
    .toggle-group {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .toggle-btn {
      background: rgba(255,255,255,0.1);
      border: 2px solid #555;
      color: #888;
      padding: 10px 20px;
      font-size: 14px;
    }
    .toggle-btn:hover { border-color: #888; }
    .toggle-btn.on {
      background: rgba(78, 205, 196, 0.3);
      border-color: #4ecdc4;
      color: #4ecdc4;
    }

    /* Visual bass display */
    .bass-display {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
    }
    .chord-progression {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
    }
    .chord-box {
      background: rgba(233, 69, 96, 0.2);
      border: 2px solid #444;
      border-radius: 8px;
      padding: 15px 25px;
      text-align: center;
      min-width: 100px;
      transition: all 0.2s;
    }
    .chord-box.active {
      border-color: #e94560;
      background: rgba(233, 69, 96, 0.4);
      box-shadow: 0 0 15px rgba(233, 69, 96, 0.5);
    }
    .chord-name {
      font-size: 20px;
      font-weight: bold;
      color: #e94560;
    }
    .chord-root {
      font-size: 14px;
      color: #888;
      margin-top: 5px;
    }

    .current-note {
      text-align: center;
      margin-top: 15px;
      padding: 15px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    .note-label {
      font-size: 12px;
      color: #888;
      margin-bottom: 5px;
    }
    .note-value {
      font-size: 36px;
      font-weight: bold;
      color: #4ecdc4;
      font-family: 'Courier New', monospace;
    }

    .info-box {
      background: rgba(78, 205, 196, 0.1);
      border-left: 4px solid #4ecdc4;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    .info-box.tip {
      background: rgba(255, 215, 0, 0.1);
      border-left-color: #ffd700;
    }

    .legend {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #888;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }
    .legend-color.bass { background: #4ecdc4; }
    .legend-color.chord { background: #e94560; }
    .legend-color.drum { background: #ffd700; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bass Lines</h1>
    <p class="subtitle">Explore different bass patterns with a lofi chord progression</p>

    <div id="status">Click Play to start</div>

    <div class="section">
      <h2>Bass Pattern</h2>
      <p>Select a bass pattern style:</p>

      <div class="pattern-selector">
        <button class="pattern-btn active" id="patternRoot">Root Notes</button>
        <button class="pattern-btn" id="patternOctave">Octave</button>
        <button class="pattern-btn" id="patternWalking">Walking</button>
        <button class="pattern-btn" id="patternSyncopated">Syncopated</button>
      </div>

      <div id="patternInfo" class="info-box">
        <strong>Root Notes:</strong> The simplest approach - just play the root note of each chord. Solid foundation without complexity.
      </div>
    </div>

    <div class="section">
      <h2>Chord Progression</h2>
      <p>Dm7 - G7 - Cmaj7 - Am7 (classic ii-V-I-vi)</p>

      <div class="bass-display">
        <div class="chord-progression">
          <div class="chord-box" id="chord0">
            <div class="chord-name">Dm7</div>
            <div class="chord-root">Root: D</div>
          </div>
          <div class="chord-box" id="chord1">
            <div class="chord-name">G7</div>
            <div class="chord-root">Root: G</div>
          </div>
          <div class="chord-box" id="chord2">
            <div class="chord-name">Cmaj7</div>
            <div class="chord-root">Root: C</div>
          </div>
          <div class="chord-box" id="chord3">
            <div class="chord-name">Am7</div>
            <div class="chord-root">Root: A</div>
          </div>
        </div>

        <div class="current-note">
          <div class="note-label">Current Bass Note</div>
          <div class="note-value" id="currentNote">--</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Mix Controls</h2>
      <p>Toggle elements to hear how bass interacts with other instruments:</p>

      <div class="toggle-group">
        <button class="toggle-btn on" id="toggleBass">Bass</button>
        <button class="toggle-btn on" id="toggleChords">Chords</button>
        <button class="toggle-btn on" id="toggleDrums">Drums</button>
      </div>

      <div class="legend">
        <div class="legend-item"><div class="legend-color bass"></div>Bass (MonoSynth)</div>
        <div class="legend-item"><div class="legend-color chord"></div>Chords (PolySynth)</div>
        <div class="legend-item"><div class="legend-color drum"></div>Drums (Kick + Hat)</div>
      </div>
    </div>

    <div class="section">
      <h2>Sound Controls</h2>

      <div class="controls" style="justify-content: center;">
        <div class="control">
          <label>BPM</label>
          <input type="range" id="bpm" min="60" max="120" value="85">
          <span class="value" id="bpmVal">85</span>
        </div>
        <div class="control">
          <label>Filter</label>
          <input type="range" id="filter" min="200" max="2000" value="800">
          <span class="value" id="filterVal">800 Hz</span>
        </div>
        <div class="control">
          <label>Attack</label>
          <input type="range" id="attack" min="0.01" max="0.2" step="0.01" value="0.05">
          <span class="value" id="attackVal">50 ms</span>
        </div>
      </div>

      <div class="transport-buttons">
        <button class="play-btn" id="playBtn">&#9658;</button>
        <button class="secondary" id="stopBtn">Stop</button>
      </div>
    </div>

    <div class="info-box tip">
      <strong>Tips:</strong>
      <ul style="margin: 10px 0; padding-left: 20px; color: #aaa;">
        <li>Try turning off chords to hear just bass + drums - notice how bass provides harmonic context</li>
        <li>Compare "Root Notes" vs "Walking" to hear the difference in movement</li>
        <li>Lower the filter cutoff for a warmer, more muffled sound</li>
        <li>Increase attack for a softer, more rounded bass tone</li>
      </ul>
    </div>
  </div>

  <script>
    // State
    let isPlaying = false;
    let currentPattern = 'root';
    let currentChordIndex = -1;
    let bassEnabled = true;
    let chordsEnabled = true;
    let drumsEnabled = true;

    // Instruments
    let bass, chordSynth, kick, hihat, hihatFilter;
    let bassSeq, chordSeq, kickSeq, hatSeq;

    // Chord data
    const chords = [
      { name: 'Dm7', notes: ['D3', 'F3', 'A3', 'C4'], root: 'D' },
      { name: 'G7', notes: ['G2', 'B2', 'D3', 'F3'], root: 'G' },
      { name: 'Cmaj7', notes: ['C3', 'E3', 'G3', 'B3'], root: 'C' },
      { name: 'Am7', notes: ['A2', 'C3', 'E3', 'G3'], root: 'A' }
    ];

    // Bass patterns for each style
    const bassPatterns = {
      root: [
        ['D2', null, null, null],
        ['G2', null, null, null],
        ['C3', null, null, null],
        ['A2', null, null, null]
      ],
      octave: [
        ['D2', null, 'D3', null],
        ['G2', null, 'G3', null],
        ['C3', null, 'C4', null],
        ['A2', null, 'A3', null]
      ],
      walking: [
        ['D2', 'E2', 'F2', 'G2'],
        ['G2', 'F2', 'E2', 'D2'],
        ['C2', 'D2', 'E2', 'F2'],
        ['A2', 'G2', 'F2', 'E2']
      ],
      syncopated: [
        [null, 'D2', null, 'D3'],
        [null, 'G2', null, 'G3'],
        [null, 'C3', null, 'C4'],
        [null, 'A2', null, 'A3']
      ]
    };

    const patternDescriptions = {
      root: 'The simplest approach - just play the root note of each chord. Solid foundation without complexity.',
      octave: 'Add the octave above the root for movement and energy while staying harmonically simple.',
      walking: 'Jazz-influenced bass that walks through chord tones, creating melodic movement between chords.',
      syncopated: 'Off-beat rhythmic pattern that creates groove by hitting between the main beats.'
    };

    // Initialize instruments
    function initInstruments() {
      // Bass - MonoSynth with triangle wave
      bass = new Tone.MonoSynth({
        oscillator: { type: 'triangle' },
        filter: {
          type: 'lowpass',
          frequency: 800,
          Q: 1
        },
        envelope: {
          attack: 0.05,
          decay: 0.3,
          sustain: 0.6,
          release: 0.5
        },
        filterEnvelope: {
          attack: 0.1,
          decay: 0.2,
          sustain: 0.4,
          release: 0.5,
          baseFrequency: 200,
          octaves: 2
        }
      }).toDestination();
      bass.volume.value = -6;

      // Chord synth - PolySynth for playing multiple notes
      chordSynth = new Tone.PolySynth(Tone.Synth, {
        oscillator: { type: 'sine' },
        envelope: {
          attack: 0.1,
          decay: 0.4,
          sustain: 0.6,
          release: 0.8
        }
      }).toDestination();
      chordSynth.volume.value = -12;

      // Drums
      kick = new Tone.MembraneSynth({
        pitchDecay: 0.05,
        octaves: 4,
        oscillator: { type: 'sine' },
        envelope: {
          attack: 0.001,
          decay: 0.4,
          sustain: 0,
          release: 0.4
        }
      }).toDestination();
      kick.volume.value = -8;

      hihatFilter = new Tone.Filter(6000, 'lowpass').toDestination();
      hihat = new Tone.NoiseSynth({
        noise: { type: 'white' },
        envelope: {
          attack: 0.001,
          decay: 0.08,
          sustain: 0,
          release: 0.05
        }
      }).connect(hihatFilter);
      hihat.volume.value = -14;
    }

    // Create sequences
    function createSequences() {
      // Chord sequence - one chord per bar
      chordSeq = new Tone.Sequence((time, chordIdx) => {
        currentChordIndex = chordIdx;

        Tone.Draw.schedule(() => {
          updateChordDisplay(chordIdx);
        }, time);

        if (chordsEnabled) {
          chordSynth.triggerAttackRelease(chords[chordIdx].notes, '1n', time);
        }
      }, [0, 1, 2, 3], '1n');

      // Bass sequence - pattern changes based on selection
      createBassSequence();

      // Kick pattern
      kickSeq = new Tone.Sequence((time, hit) => {
        if (hit && drumsEnabled) {
          kick.triggerAttackRelease('C1', '8n', time);
        }
      }, [1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0], '16n');

      // Hi-hat pattern
      hatSeq = new Tone.Sequence((time, hit) => {
        if (hit && drumsEnabled) {
          hihat.triggerAttackRelease('16n', time);
        }
      }, [0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0], '16n');
    }

    function createBassSequence() {
      if (bassSeq) {
        bassSeq.stop();
        bassSeq.dispose();
      }

      const pattern = bassPatterns[currentPattern];

      // Flatten pattern: 4 chords x 4 beats = 16 notes
      const flatPattern = pattern.flat();

      bassSeq = new Tone.Sequence((time, note) => {
        const stepInLoop = Math.floor((Tone.Transport.position.split(':')[1] || 0) % 4);

        Tone.Draw.schedule(() => {
          updateNoteDisplay(note);
        }, time);

        if (note && bassEnabled) {
          bass.triggerAttackRelease(note, '8n', time);
        }
      }, flatPattern, '4n');

      if (isPlaying) {
        bassSeq.start(0);
      }
    }

    function updateChordDisplay(idx) {
      document.querySelectorAll('.chord-box').forEach((el, i) => {
        el.classList.toggle('active', i === idx);
      });
    }

    function updateNoteDisplay(note) {
      document.getElementById('currentNote').textContent = note || '--';
    }

    // Play/Stop controls
    async function startPlayback() {
      await Tone.start();

      if (!isPlaying) {
        chordSeq.start(0);
        bassSeq.start(0);
        kickSeq.start(0);
        hatSeq.start(0);
        Tone.Transport.start();
        isPlaying = true;
        document.getElementById('playBtn').innerHTML = '&#10074;&#10074;';
        document.getElementById('playBtn').classList.add('playing');
        document.getElementById('status').textContent = 'Playing...';
      } else {
        Tone.Transport.pause();
        isPlaying = false;
        document.getElementById('playBtn').innerHTML = '&#9658;';
        document.getElementById('playBtn').classList.remove('playing');
        document.getElementById('status').textContent = 'Paused';
      }
    }

    function stopPlayback() {
      Tone.Transport.stop();
      Tone.Transport.position = 0;
      isPlaying = false;
      currentChordIndex = -1;
      updateChordDisplay(-1);
      updateNoteDisplay(null);
      document.getElementById('playBtn').innerHTML = '&#9658;';
      document.getElementById('playBtn').classList.remove('playing');
      document.getElementById('status').textContent = 'Stopped';
    }

    // Pattern selection
    function selectPattern(pattern) {
      currentPattern = pattern;

      // Update buttons
      document.querySelectorAll('.pattern-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      // Update info
      document.getElementById('patternInfo').innerHTML =
        `<strong>${pattern.charAt(0).toUpperCase() + pattern.slice(1)}:</strong> ${patternDescriptions[pattern]}`;

      // Recreate bass sequence with new pattern
      createBassSequence();
    }

    // Toggle handlers
    function toggleBass() {
      bassEnabled = !bassEnabled;
      document.getElementById('toggleBass').classList.toggle('on', bassEnabled);
    }

    function toggleChords() {
      chordsEnabled = !chordsEnabled;
      document.getElementById('toggleChords').classList.toggle('on', chordsEnabled);
    }

    function toggleDrums() {
      drumsEnabled = !drumsEnabled;
      document.getElementById('toggleDrums').classList.toggle('on', drumsEnabled);
    }

    // Control handlers
    function setupControls() {
      // BPM
      document.getElementById('bpm').addEventListener('input', (e) => {
        const val = parseInt(e.target.value);
        document.getElementById('bpmVal').textContent = val;
        Tone.Transport.bpm.value = val;
      });

      // Filter
      document.getElementById('filter').addEventListener('input', (e) => {
        const val = parseInt(e.target.value);
        document.getElementById('filterVal').textContent = val + ' Hz';
        bass.filter.frequency.value = val;
      });

      // Attack
      document.getElementById('attack').addEventListener('input', (e) => {
        const val = parseFloat(e.target.value);
        document.getElementById('attackVal').textContent = Math.round(val * 1000) + ' ms';
        bass.envelope.attack = val;
      });

      // Pattern buttons
      document.getElementById('patternRoot').addEventListener('click', () => selectPattern('root'));
      document.getElementById('patternOctave').addEventListener('click', () => selectPattern('octave'));
      document.getElementById('patternWalking').addEventListener('click', () => selectPattern('walking'));
      document.getElementById('patternSyncopated').addEventListener('click', () => selectPattern('syncopated'));

      // Toggle buttons
      document.getElementById('toggleBass').addEventListener('click', toggleBass);
      document.getElementById('toggleChords').addEventListener('click', toggleChords);
      document.getElementById('toggleDrums').addEventListener('click', toggleDrums);

      // Transport
      document.getElementById('playBtn').addEventListener('click', startPlayback);
      document.getElementById('stopBtn').addEventListener('click', stopPlayback);
    }

    // Initialize
    function init() {
      initInstruments();
      createSequences();
      setupControls();
      Tone.Transport.bpm.value = 85;
    }

    init();
  </script>
</body>
</html>
