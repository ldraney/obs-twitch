<!DOCTYPE html>
<html>
<head>
  <title>Chord Progressions - Demo</title>
  <script src="https://unpkg.com/tone@14"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { color: #e94560; margin-bottom: 10px; }
    h2 { color: #4ecdc4; margin-top: 30px; }
    .subtitle { color: #888; margin-bottom: 30px; }

    .section {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    button {
      background: #e94560;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 8px;
      margin: 5px;
      transition: transform 0.1s, background 0.2s;
    }
    button:hover { background: #ff6b6b; transform: scale(1.02); }
    button:active { transform: scale(0.98); }
    button:disabled { background: #444; cursor: not-allowed; transform: none; }
    button.secondary { background: #4ecdc4; }
    button.secondary:hover { background: #6ee7df; }

    #status {
      text-align: center;
      padding: 10px;
      color: #888;
      font-size: 14px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      margin: 10px 0;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 15px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .control {
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .control label {
      color: #888;
      font-size: 12px;
      min-width: 50px;
    }
    .control .value {
      color: #e94560;
      font-weight: bold;
      min-width: 60px;
      text-align: right;
    }
    .control input[type="range"] {
      width: 120px;
      accent-color: #e94560;
    }

    select {
      background: rgba(0,0,0,0.3);
      color: #eee;
      border: 2px solid #4ecdc4;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      min-width: 200px;
    }
    select:focus {
      outline: none;
      border-color: #e94560;
    }

    .transport-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }

    .play-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .play-btn.playing { background: #4ecdc4; }

    /* Chord Display */
    .chord-display {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px 0;
    }

    .chord-card {
      background: rgba(0,0,0,0.3);
      border: 3px solid rgba(78, 205, 196, 0.3);
      border-radius: 12px;
      padding: 20px 30px;
      min-width: 140px;
      text-align: center;
      transition: all 0.2s;
    }
    .chord-card.active {
      border-color: #e94560;
      background: rgba(233, 69, 96, 0.2);
      transform: scale(1.08);
      box-shadow: 0 0 20px rgba(233, 69, 96, 0.4);
    }
    .chord-name {
      font-size: 28px;
      font-weight: bold;
      color: #4ecdc4;
      margin-bottom: 5px;
    }
    .chord-card.active .chord-name {
      color: #e94560;
    }
    .chord-numeral {
      font-size: 14px;
      color: #666;
    }
    .chord-card.active .chord-numeral {
      color: #888;
    }

    /* Progression Info */
    .progression-info {
      background: rgba(78, 205, 196, 0.1);
      border-left: 4px solid #4ecdc4;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    .progression-title {
      color: #4ecdc4;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .progression-desc {
      color: #aaa;
      font-size: 14px;
    }

    /* Toggle */
    .toggle-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .toggle {
      background: rgba(0,0,0,0.3);
      border: 2px solid #444;
      color: #888;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .toggle.active {
      background: rgba(78, 205, 196, 0.2);
      border-color: #4ecdc4;
      color: #4ecdc4;
    }
    .toggle:hover {
      border-color: #666;
    }

    .info-box {
      background: rgba(78, 205, 196, 0.1);
      border-left: 4px solid #4ecdc4;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    .info-box.tip {
      background: rgba(255, 215, 0, 0.1);
      border-left-color: #ffd700;
    }

    /* Duration buttons */
    .duration-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .duration-btn {
      background: rgba(0,0,0,0.3);
      border: 2px solid #444;
      color: #888;
      padding: 10px 20px;
      font-size: 14px;
    }
    .duration-btn.active {
      background: rgba(233, 69, 96, 0.2);
      border-color: #e94560;
      color: #e94560;
    }
    .duration-btn:hover {
      border-color: #666;
      background: rgba(255,255,255,0.05);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Chord Progressions</h1>
    <p class="subtitle">Interactive lofi chord progression player</p>

    <div id="status">Click Play to start the progression</div>

    <div class="section">
      <h2>Choose a Progression</h2>
      <p>Select a preset progression to hear how different chord sequences create different moods.</p>

      <div class="controls" style="justify-content: center;">
        <select id="progressionSelect">
          <option value="ii-V-I">ii-V-I (Jazz Classic)</option>
          <option value="I-vi-ii-V">I-vi-ii-V (Turnaround)</option>
          <option value="lofi-loop" selected>Lofi Loop (ii-V-I-vi)</option>
          <option value="emotional">Emotional (vi-IV-I-V)</option>
          <option value="neo-soul">Neo Soul (IVmaj9-iii9-vi9-ii9)</option>
        </select>
      </div>

      <div class="progression-info" id="progressionInfo">
        <div class="progression-title">Lofi Loop (ii-V-I-vi)</div>
        <div class="progression-desc">The quintessential lofi progression. Combines jazz movement with emotional depth. Perfect for laid-back vibes.</div>
      </div>

      <div class="chord-display" id="chordDisplay">
        <!-- Filled by JS -->
      </div>

      <div class="transport-buttons">
        <button class="play-btn" id="playBtn">&#9658;</button>
        <button class="secondary" id="stopBtn">&#9632; Stop</button>
      </div>

      <div class="controls" style="justify-content: center;">
        <div class="control">
          <label>BPM</label>
          <input type="range" id="bpm" min="60" max="100" value="75">
          <span class="value" id="bpmVal">75</span>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Options</h2>

      <div class="controls" style="justify-content: center; gap: 30px;">
        <div>
          <p style="color: #888; margin-bottom: 10px; text-align: center;">Chord Duration</p>
          <div class="duration-buttons">
            <button class="duration-btn" id="durationHalf">Half Notes</button>
            <button class="duration-btn active" id="durationWhole">Whole Notes</button>
          </div>
        </div>

        <div>
          <p style="color: #888; margin-bottom: 10px; text-align: center;">Accompaniment</p>
          <div class="toggle-group">
            <button class="toggle active" id="toggleDrums">Drums</button>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Chord Reference</h2>
      <p>Click any chord to hear it individually:</p>

      <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 15px 0;">
        <button class="secondary" data-chord="Cmaj7">Cmaj7</button>
        <button class="secondary" data-chord="Dm7">Dm7</button>
        <button class="secondary" data-chord="Em7">Em7</button>
        <button class="secondary" data-chord="Fmaj7">Fmaj7</button>
        <button class="secondary" data-chord="G7">G7</button>
        <button class="secondary" data-chord="Am7">Am7</button>
      </div>
    </div>

    <div class="info-box tip">
      <strong>Tip:</strong> Listen to how the progression "resolves" at different points. The ii-V-I feels like coming home, while the lofi loop keeps you in gentle motion forever.
    </div>
  </div>

  <script>
    // Progression definitions
    const progressions = {
      'ii-V-I': {
        name: 'ii-V-I (Jazz Classic)',
        description: 'The most fundamental jazz progression. Smooth tension and resolution. The V chord creates anticipation that resolves to I.',
        chords: [
          { name: 'Dm7', numeral: 'ii', notes: ['D3', 'F3', 'A3', 'C4'] },
          { name: 'G7', numeral: 'V', notes: ['G2', 'B3', 'D4', 'F4'] },
          { name: 'Cmaj7', numeral: 'I', notes: ['C3', 'E3', 'G3', 'B3'] }
        ]
      },
      'I-vi-ii-V': {
        name: 'I-vi-ii-V (Turnaround)',
        description: 'Classic jazz turnaround. Creates a complete cycle that leads back to the beginning. Used in countless standards.',
        chords: [
          { name: 'Cmaj7', numeral: 'I', notes: ['C3', 'E3', 'G3', 'B3'] },
          { name: 'Am7', numeral: 'vi', notes: ['A2', 'C3', 'E3', 'G3'] },
          { name: 'Dm7', numeral: 'ii', notes: ['D3', 'F3', 'A3', 'C4'] },
          { name: 'G7', numeral: 'V', notes: ['G2', 'B3', 'D4', 'F4'] }
        ]
      },
      'lofi-loop': {
        name: 'Lofi Loop (ii-V-I-vi)',
        description: 'The quintessential lofi progression. Combines jazz movement with emotional depth. Perfect for laid-back vibes.',
        chords: [
          { name: 'Dm7', numeral: 'ii', notes: ['D3', 'F3', 'A3', 'C4'] },
          { name: 'G7', numeral: 'V', notes: ['G2', 'B3', 'D4', 'F4'] },
          { name: 'Cmaj7', numeral: 'I', notes: ['C3', 'E3', 'G3', 'B3'] },
          { name: 'Am7', numeral: 'vi', notes: ['A2', 'C3', 'E3', 'G3'] }
        ]
      },
      'emotional': {
        name: 'Emotional (vi-IV-I-V)',
        description: 'The "sad but hopeful" progression. Starting on minor creates melancholy, but major chords lift it. Very popular in pop and lofi.',
        chords: [
          { name: 'Am7', numeral: 'vi', notes: ['A2', 'C3', 'E3', 'G3'] },
          { name: 'Fmaj7', numeral: 'IV', notes: ['F2', 'A3', 'C4', 'E4'] },
          { name: 'Cmaj7', numeral: 'I', notes: ['C3', 'E3', 'G3', 'B3'] },
          { name: 'G7', numeral: 'V', notes: ['G2', 'B3', 'D4', 'F4'] }
        ]
      },
      'neo-soul': {
        name: 'Neo Soul (IVmaj9-iii9-vi9-ii9)',
        description: 'Rich extended chords with chromatic movement. Sophisticated harmony with lush 9th chords. Perfect for dreamy, soulful vibes.',
        chords: [
          { name: 'Fmaj9', numeral: 'IV', notes: ['F2', 'A3', 'C4', 'E4', 'G4'] },
          { name: 'Em9', numeral: 'iii', notes: ['E2', 'G3', 'B3', 'D4', 'F#4'] },
          { name: 'Am9', numeral: 'vi', notes: ['A2', 'C3', 'E3', 'G3', 'B3'] },
          { name: 'Dm9', numeral: 'ii', notes: ['D3', 'F3', 'A3', 'C4', 'E4'] }
        ]
      }
    };

    // Single chord definitions for reference
    const chordReference = {
      'Cmaj7': ['C3', 'E3', 'G3', 'B3'],
      'Dm7': ['D3', 'F3', 'A3', 'C4'],
      'Em7': ['E3', 'G3', 'B3', 'D4'],
      'Fmaj7': ['F2', 'A3', 'C4', 'E4'],
      'G7': ['G2', 'B3', 'D4', 'F4'],
      'Am7': ['A2', 'C3', 'E3', 'G3']
    };

    // State
    let isPlaying = false;
    let currentChordIndex = 0;
    let currentProgression = 'lofi-loop';
    let drumsEnabled = true;
    let chordDuration = '1m'; // whole note

    // Synths
    let pad, kick, snare, hihat, filter, reverb;
    let chordLoop, kickLoop, snareLoop, hihatLoop;

    // Initialize synths
    function initSynths() {
      // Pad synth for chords
      pad = new Tone.PolySynth(Tone.Synth, {
        oscillator: { type: 'triangle' },
        envelope: {
          attack: 0.2,
          decay: 0.5,
          sustain: 0.5,
          release: 1.2
        }
      });

      // Effects
      filter = new Tone.Filter(2500, 'lowpass');
      reverb = new Tone.Reverb({ decay: 2.5, wet: 0.35 });

      pad.chain(filter, reverb, Tone.Destination);
      pad.volume.value = -12;

      // Drums
      kick = new Tone.MembraneSynth({
        pitchDecay: 0.05,
        octaves: 4,
        envelope: { attack: 0.001, decay: 0.4, sustain: 0, release: 0.4 }
      }).toDestination();
      kick.volume.value = -8;

      snare = new Tone.NoiseSynth({
        noise: { type: 'white' },
        envelope: { attack: 0.001, decay: 0.15, sustain: 0, release: 0.1 }
      }).toDestination();
      snare.volume.value = -12;

      const hihatFilter = new Tone.Filter(8000, 'lowpass').toDestination();
      hihat = new Tone.NoiseSynth({
        noise: { type: 'white' },
        envelope: { attack: 0.001, decay: 0.08, sustain: 0, release: 0.05 }
      }).connect(hihatFilter);
      hihat.volume.value = -18;
    }

    // Build chord display
    function buildChordDisplay() {
      const container = document.getElementById('chordDisplay');
      container.innerHTML = '';

      const prog = progressions[currentProgression];
      prog.chords.forEach((chord, index) => {
        const card = document.createElement('div');
        card.className = 'chord-card';
        card.dataset.index = index;
        card.innerHTML = `
          <div class="chord-name">${chord.name}</div>
          <div class="chord-numeral">${chord.numeral}</div>
        `;
        container.appendChild(card);
      });

      // Update info
      const info = document.getElementById('progressionInfo');
      info.innerHTML = `
        <div class="progression-title">${prog.name}</div>
        <div class="progression-desc">${prog.description}</div>
      `;
    }

    // Highlight current chord
    function highlightChord(index) {
      document.querySelectorAll('.chord-card').forEach((card, i) => {
        card.classList.toggle('active', i === index);
      });
    }

    // Create loops
    function createLoops() {
      // Clean up existing loops
      if (chordLoop) chordLoop.dispose();
      if (kickLoop) kickLoop.dispose();
      if (snareLoop) snareLoop.dispose();
      if (hihatLoop) hihatLoop.dispose();

      const prog = progressions[currentProgression];
      const numChords = prog.chords.length;

      // Chord loop
      chordLoop = new Tone.Loop((time) => {
        const chord = prog.chords[currentChordIndex];

        // Visual update
        Tone.Draw.schedule(() => {
          highlightChord(currentChordIndex);
          document.getElementById('status').textContent = `Playing: ${chord.name}`;
        }, time);

        // Play chord
        const duration = chordDuration === '2n' ? '2n' : '1m';
        pad.triggerAttackRelease(chord.notes, duration, time, 0.6);

        // Next chord
        currentChordIndex = (currentChordIndex + 1) % numChords;
      }, chordDuration);

      // Drum loops (16 steps per bar)
      kickLoop = new Tone.Sequence((time, hit) => {
        if (hit && drumsEnabled) kick.triggerAttackRelease('C1', '8n', time);
      }, [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], '16n');

      snareLoop = new Tone.Sequence((time, hit) => {
        if (hit && drumsEnabled) snare.triggerAttackRelease('8n', time);
      }, [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], '16n');

      hihatLoop = new Tone.Sequence((time, hit) => {
        if (hit && drumsEnabled) hihat.triggerAttackRelease('16n', time);
      }, [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], '16n');

      chordLoop.start(0);
      kickLoop.start(0);
      snareLoop.start(0);
      hihatLoop.start(0);
    }

    // Play/Stop
    async function togglePlayback() {
      await Tone.start();

      if (isPlaying) {
        Tone.Transport.stop();
        Tone.Transport.position = 0;
        isPlaying = false;
        currentChordIndex = 0;
        highlightChord(-1);
        document.getElementById('playBtn').innerHTML = '&#9658;';
        document.getElementById('playBtn').classList.remove('playing');
        document.getElementById('status').textContent = 'Stopped';
      } else {
        currentChordIndex = 0;
        createLoops();
        Tone.Transport.start();
        isPlaying = true;
        document.getElementById('playBtn').innerHTML = '&#10074;&#10074;';
        document.getElementById('playBtn').classList.add('playing');
      }
    }

    // Stop playback
    function stopPlayback() {
      if (isPlaying) {
        Tone.Transport.stop();
        Tone.Transport.position = 0;
        isPlaying = false;
        currentChordIndex = 0;
        highlightChord(-1);
        document.getElementById('playBtn').innerHTML = '&#9658;';
        document.getElementById('playBtn').classList.remove('playing');
        document.getElementById('status').textContent = 'Stopped';
      }
    }

    // Play single chord
    async function playChord(notes) {
      await Tone.start();
      pad.triggerAttackRelease(notes, '2n', undefined, 0.6);
    }

    // Event listeners
    function setupEventListeners() {
      // Play button
      document.getElementById('playBtn').addEventListener('click', togglePlayback);
      document.getElementById('stopBtn').addEventListener('click', stopPlayback);

      // BPM
      document.getElementById('bpm').addEventListener('input', (e) => {
        const val = parseInt(e.target.value);
        document.getElementById('bpmVal').textContent = val;
        Tone.Transport.bpm.value = val;
      });

      // Progression select
      document.getElementById('progressionSelect').addEventListener('change', (e) => {
        currentProgression = e.target.value;
        currentChordIndex = 0;
        buildChordDisplay();
        if (isPlaying) {
          createLoops();
        }
      });

      // Duration buttons
      document.getElementById('durationHalf').addEventListener('click', () => {
        chordDuration = '2n';
        document.getElementById('durationHalf').classList.add('active');
        document.getElementById('durationWhole').classList.remove('active');
        if (isPlaying) {
          createLoops();
        }
      });

      document.getElementById('durationWhole').addEventListener('click', () => {
        chordDuration = '1m';
        document.getElementById('durationWhole').classList.add('active');
        document.getElementById('durationHalf').classList.remove('active');
        if (isPlaying) {
          createLoops();
        }
      });

      // Drums toggle
      document.getElementById('toggleDrums').addEventListener('click', (e) => {
        drumsEnabled = !drumsEnabled;
        e.target.classList.toggle('active', drumsEnabled);
      });

      // Chord reference buttons
      document.querySelectorAll('[data-chord]').forEach(btn => {
        btn.addEventListener('click', () => {
          const chordName = btn.dataset.chord;
          const notes = chordReference[chordName];
          if (notes) playChord(notes);
        });
      });
    }

    // Initialize
    function init() {
      initSynths();
      buildChordDisplay();
      setupEventListeners();
      Tone.Transport.bpm.value = 75;
    }

    init();
  </script>
</body>
</html>
