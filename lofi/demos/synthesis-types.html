<!DOCTYPE html>
<html>
<head>
  <title>Synthesis Types - Demo</title>
  <script src="https://unpkg.com/tone@14"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { color: #e94560; margin-bottom: 10px; }
    h2 { color: #4ecdc4; margin-top: 30px; }
    .subtitle { color: #888; margin-bottom: 30px; }

    .section {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    .synth-selector {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .synth-btn {
      background: rgba(78, 205, 196, 0.2);
      color: #4ecdc4;
      border: 2px solid #4ecdc4;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
    }
    .synth-btn:hover {
      background: rgba(78, 205, 196, 0.3);
    }
    .synth-btn.active {
      background: #4ecdc4;
      color: #1a1a2e;
      font-weight: bold;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }

    .control {
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
    }
    .control label {
      display: block;
      color: #888;
      font-size: 12px;
      margin-bottom: 5px;
    }
    .control .value {
      color: #e94560;
      font-weight: bold;
      float: right;
    }
    .control input[type="range"] {
      width: 100%;
      margin-top: 5px;
    }
    .control select {
      width: 100%;
      padding: 8px;
      background: #2a2a4e;
      color: #eee;
      border: 1px solid #444;
      border-radius: 4px;
    }
    .control.hidden {
      display: none;
    }
    .control.fm-only, .control.am-only {
      border-left: 3px solid #e94560;
    }

    button {
      background: #e94560;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 8px;
      margin: 5px;
      transition: transform 0.1s, background 0.2s;
    }
    button:hover { background: #ff6b6b; transform: scale(1.02); }
    button:active { transform: scale(0.98); }
    button:disabled { background: #444; cursor: not-allowed; transform: none; }

    .keyboard {
      display: flex;
      gap: 5px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .key {
      background: #4ecdc4;
      color: #1a1a2e;
      border: none;
      padding: 20px 15px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.1s;
    }
    .key:hover { background: #6ee7df; transform: translateY(-2px); }
    .key:active { transform: translateY(0); background: #e94560; }
    .key.black { background: #2a2a4e; color: #eee; padding: 15px 10px; }
    .key.black:hover { background: #3a3a6e; }
    .key.black:active { background: #e94560; }

    #status {
      text-align: center;
      padding: 10px;
      color: #888;
      font-size: 14px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      margin: 10px 0;
    }

    .synth-description {
      background: rgba(233, 69, 96, 0.1);
      border-left: 3px solid #e94560;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    .synth-description h3 {
      margin: 0 0 10px 0;
      color: #e94560;
    }
    .synth-description p {
      margin: 0;
      line-height: 1.6;
    }

    .tip {
      background: rgba(78, 205, 196, 0.1);
      border-left: 3px solid #4ecdc4;
      padding: 10px 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
      font-size: 14px;
    }
    .tip strong { color: #4ecdc4; }

    .chord-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 15px 0;
    }
    .chord-btn {
      background: rgba(233, 69, 96, 0.2);
      border: 1px solid #e94560;
    }
    .chord-btn:hover {
      background: #e94560;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Synthesis Types</h1>
    <p class="subtitle">Compare subtractive, FM, and AM synthesis in Tone.js</p>

    <div class="section">
      <h2>1. Choose Synthesis Type</h2>
      <p>Each synthesis method creates sound differently:</p>

      <div class="synth-selector">
        <button class="synth-btn active" data-synth="Synth">Synth (Basic)</button>
        <button class="synth-btn" data-synth="MonoSynth">MonoSynth (Subtractive)</button>
        <button class="synth-btn" data-synth="FMSynth">FMSynth (FM)</button>
        <button class="synth-btn" data-synth="AMSynth">AMSynth (AM)</button>
      </div>

      <div class="synth-description" id="synthDesc">
        <h3>Synth - Basic Oscillator</h3>
        <p>Single oscillator with ADSR envelope. No built-in filter. Great for learning the fundamentals.</p>
      </div>
    </div>

    <div class="section">
      <h2>2. Parameters</h2>

      <div class="controls">
        <!-- Common controls -->
        <div class="control">
          <label>Oscillator Type</label>
          <select id="oscType">
            <option value="sine">Sine - Pure, mellow</option>
            <option value="triangle" selected>Triangle - Soft, warm</option>
            <option value="square">Square - Hollow, retro</option>
            <option value="sawtooth">Sawtooth - Bright, rich</option>
          </select>
        </div>

        <div class="control">
          <label>Volume <span class="value" id="volumeVal">-6 dB</span></label>
          <input type="range" id="volume" min="-24" max="0" step="1" value="-6">
        </div>

        <!-- MonoSynth: Filter controls -->
        <div class="control mono-only hidden">
          <label>Filter Frequency <span class="value" id="filterFreqVal">800 Hz</span></label>
          <input type="range" id="filterFreq" min="100" max="5000" step="50" value="800">
        </div>

        <div class="control mono-only hidden">
          <label>Filter Q (Resonance) <span class="value" id="filterQVal">2</span></label>
          <input type="range" id="filterQ" min="0.5" max="10" step="0.5" value="2">
        </div>

        <!-- FM: Unique controls -->
        <div class="control fm-only hidden">
          <label>Modulation Index <span class="value" id="modIndexVal">10</span></label>
          <input type="range" id="modIndex" min="0" max="40" step="1" value="10">
        </div>

        <div class="control fm-only hidden">
          <label>Harmonicity <span class="value" id="fmHarmVal">2</span></label>
          <input type="range" id="fmHarm" min="0.5" max="8" step="0.5" value="2">
        </div>

        <!-- AM: Unique controls -->
        <div class="control am-only hidden">
          <label>Harmonicity <span class="value" id="amHarmVal">1.5</span></label>
          <input type="range" id="amHarm" min="0.5" max="4" step="0.1" value="1.5">
        </div>
      </div>

      <div class="tip" id="paramTip">
        <strong>Tip:</strong> Try different oscillator types to hear how they affect the tone character.
      </div>
    </div>

    <div class="section">
      <h2>3. Play & Compare</h2>

      <div class="keyboard">
        <button class="key" data-note="C4">C</button>
        <button class="key black" data-note="C#4">C#</button>
        <button class="key" data-note="D4">D</button>
        <button class="key black" data-note="D#4">D#</button>
        <button class="key" data-note="E4">E</button>
        <button class="key" data-note="F4">F</button>
        <button class="key black" data-note="F#4">F#</button>
        <button class="key" data-note="G4">G</button>
        <button class="key black" data-note="G#4">G#</button>
        <button class="key" data-note="A4">A</button>
        <button class="key black" data-note="A#4">A#</button>
        <button class="key" data-note="B4">B</button>
        <button class="key" data-note="C5">C</button>
      </div>

      <div class="chord-buttons">
        <button class="chord-btn" data-chord="major">C Major</button>
        <button class="chord-btn" data-chord="minor">A Minor</button>
        <button class="chord-btn" data-chord="seventh">Cmaj7</button>
        <button class="chord-btn" data-chord="lofi">Lofi Chord</button>
      </div>

      <div id="status">Click a key or chord to play (keyboard: A-L for notes)</div>
    </div>

    <div class="section">
      <h2>4. Presets</h2>
      <p>Quick settings for common lofi sounds:</p>

      <div class="chord-buttons">
        <button id="presetEPiano">Electric Piano (FM)</button>
        <button id="presetBass">Warm Bass (Subtractive)</button>
        <button id="presetPad">Soft Pad (AM)</button>
        <button id="presetBell">Bell Tone (FM)</button>
      </div>
    </div>
  </div>

  <script>
    // Synth instances
    let currentSynth = null;
    let currentType = 'Synth';

    // Descriptions for each synth type
    const descriptions = {
      'Synth': {
        title: 'Synth - Basic Oscillator',
        text: 'Single oscillator with ADSR envelope. No built-in filter. Great for learning the fundamentals.',
        tip: 'Try different oscillator types to hear how they affect the tone character.'
      },
      'MonoSynth': {
        title: 'MonoSynth - Subtractive Synthesis',
        text: 'Oscillator + Filter + Filter Envelope. Start bright, filter down to warmth. The classic lofi approach.',
        tip: 'Lower the filter frequency for that muffled lofi sound. Add resonance (Q) for character.'
      },
      'FMSynth': {
        title: 'FMSynth - Frequency Modulation',
        text: 'One oscillator modulates another\'s frequency. Creates complex harmonics. Perfect for electric piano and bells.',
        tip: 'Modulation Index 8-12 with Harmonicity 2-3 gives classic Rhodes piano. Higher values = more metallic.'
      },
      'AMSynth': {
        title: 'AMSynth - Amplitude Modulation',
        text: 'One oscillator modulates another\'s volume. Creates subtle, evolving timbres. Good for pads and atmosphere.',
        tip: 'Low harmonicity (1-2) creates tremolo-like softness. Great for background textures.'
      }
    };

    // Chord definitions
    const chords = {
      major: ['C4', 'E4', 'G4'],
      minor: ['A3', 'C4', 'E4'],
      seventh: ['C4', 'E4', 'G4', 'B4'],
      lofi: ['D4', 'F4', 'A4', 'C5']  // Dm7
    };

    // Create synth based on type
    function createSynth(type) {
      if (currentSynth) currentSynth.dispose();

      const oscType = document.getElementById('oscType').value;
      const volume = parseInt(document.getElementById('volume').value);

      switch(type) {
        case 'Synth':
          currentSynth = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: oscType },
            envelope: {
              attack: 0.05,
              decay: 0.3,
              sustain: 0.4,
              release: 1
            }
          });
          break;

        case 'MonoSynth':
          currentSynth = new Tone.PolySynth(Tone.MonoSynth, {
            oscillator: { type: oscType },
            filter: {
              type: 'lowpass',
              frequency: parseInt(document.getElementById('filterFreq').value),
              Q: parseFloat(document.getElementById('filterQ').value)
            },
            filterEnvelope: {
              attack: 0.05,
              decay: 0.4,
              sustain: 0.3,
              release: 0.8,
              baseFrequency: 200,
              octaves: 2.5
            },
            envelope: {
              attack: 0.05,
              decay: 0.3,
              sustain: 0.4,
              release: 1
            }
          });
          break;

        case 'FMSynth':
          currentSynth = new Tone.PolySynth(Tone.FMSynth, {
            modulationIndex: parseInt(document.getElementById('modIndex').value),
            harmonicity: parseFloat(document.getElementById('fmHarm').value),
            oscillator: { type: oscType },
            envelope: {
              attack: 0.01,
              decay: 0.5,
              sustain: 0.3,
              release: 1.2
            }
          });
          break;

        case 'AMSynth':
          currentSynth = new Tone.PolySynth(Tone.AMSynth, {
            harmonicity: parseFloat(document.getElementById('amHarm').value),
            oscillator: { type: oscType },
            envelope: {
              attack: 0.1,
              decay: 0.3,
              sustain: 0.6,
              release: 1.5
            }
          });
          break;
      }

      currentSynth.volume.value = volume;
      currentSynth.toDestination();
      currentType = type;
    }

    // Update UI for synth type
    function updateUI(type) {
      // Update buttons
      document.querySelectorAll('.synth-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.synth === type);
      });

      // Update description
      const desc = descriptions[type];
      document.getElementById('synthDesc').innerHTML = `
        <h3>${desc.title}</h3>
        <p>${desc.text}</p>
      `;
      document.getElementById('paramTip').innerHTML = `<strong>Tip:</strong> ${desc.tip}`;

      // Show/hide controls
      document.querySelectorAll('.mono-only').forEach(el => {
        el.classList.toggle('hidden', type !== 'MonoSynth');
      });
      document.querySelectorAll('.fm-only').forEach(el => {
        el.classList.toggle('hidden', type !== 'FMSynth');
      });
      document.querySelectorAll('.am-only').forEach(el => {
        el.classList.toggle('hidden', type !== 'AMSynth');
      });
    }

    // Play note
    async function playNote(note) {
      await Tone.start();
      if (!currentSynth) createSynth(currentType);
      currentSynth.triggerAttackRelease(note, '4n');
      document.getElementById('status').textContent = `Playing ${note} with ${currentType}`;
    }

    // Play chord
    async function playChord(notes) {
      await Tone.start();
      if (!currentSynth) createSynth(currentType);
      currentSynth.triggerAttackRelease(notes, '2n');
      document.getElementById('status').textContent = `Playing chord with ${currentType}`;
    }

    // Event listeners for synth type selection
    document.querySelectorAll('.synth-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const type = btn.dataset.synth;
        createSynth(type);
        updateUI(type);
      });
    });

    // Keyboard clicks
    document.querySelectorAll('.key').forEach(key => {
      key.addEventListener('click', () => playNote(key.dataset.note));
    });

    // Chord buttons
    document.querySelectorAll('.chord-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const chord = chords[btn.dataset.chord];
        if (chord) playChord(chord);
      });
    });

    // Computer keyboard mapping
    const keyMap = {
      'a': 'C4', 'w': 'C#4', 's': 'D4', 'e': 'D#4', 'd': 'E4',
      'f': 'F4', 't': 'F#4', 'g': 'G4', 'y': 'G#4', 'h': 'A4',
      'u': 'A#4', 'j': 'B4', 'k': 'C5'
    };
    document.addEventListener('keydown', (e) => {
      if (keyMap[e.key.toLowerCase()]) {
        playNote(keyMap[e.key.toLowerCase()]);
      }
    });

    // Parameter controls
    document.getElementById('oscType').addEventListener('change', () => createSynth(currentType));
    document.getElementById('volume').addEventListener('input', (e) => {
      document.getElementById('volumeVal').textContent = e.target.value + ' dB';
      if (currentSynth) currentSynth.volume.value = parseInt(e.target.value);
    });

    // MonoSynth filter controls
    document.getElementById('filterFreq').addEventListener('input', (e) => {
      document.getElementById('filterFreqVal').textContent = e.target.value + ' Hz';
      createSynth(currentType);
    });
    document.getElementById('filterQ').addEventListener('input', (e) => {
      document.getElementById('filterQVal').textContent = e.target.value;
      createSynth(currentType);
    });

    // FMSynth controls
    document.getElementById('modIndex').addEventListener('input', (e) => {
      document.getElementById('modIndexVal').textContent = e.target.value;
      createSynth(currentType);
    });
    document.getElementById('fmHarm').addEventListener('input', (e) => {
      document.getElementById('fmHarmVal').textContent = e.target.value;
      createSynth(currentType);
    });

    // AMSynth controls
    document.getElementById('amHarm').addEventListener('input', (e) => {
      document.getElementById('amHarmVal').textContent = e.target.value;
      createSynth(currentType);
    });

    // Presets
    document.getElementById('presetEPiano').addEventListener('click', async () => {
      document.getElementById('oscType').value = 'sine';
      document.getElementById('modIndex').value = 10;
      document.getElementById('fmHarm').value = 3;
      document.getElementById('modIndexVal').textContent = '10';
      document.getElementById('fmHarmVal').textContent = '3';

      // Select FM synth
      createSynth('FMSynth');
      updateUI('FMSynth');

      await Tone.start();
      playChord(['C4', 'E4', 'G4', 'B4']);
      document.getElementById('status').textContent = 'Electric Piano preset (FM) - Cmaj7';
    });

    document.getElementById('presetBass').addEventListener('click', async () => {
      document.getElementById('oscType').value = 'sawtooth';
      document.getElementById('filterFreq').value = 400;
      document.getElementById('filterQ').value = 3;
      document.getElementById('filterFreqVal').textContent = '400 Hz';
      document.getElementById('filterQVal').textContent = '3';

      // Select MonoSynth
      createSynth('MonoSynth');
      updateUI('MonoSynth');

      await Tone.start();
      playNote('C2');
      document.getElementById('status').textContent = 'Warm Bass preset (Subtractive) - C2';
    });

    document.getElementById('presetPad').addEventListener('click', async () => {
      document.getElementById('oscType').value = 'triangle';
      document.getElementById('amHarm').value = 1.5;
      document.getElementById('amHarmVal').textContent = '1.5';

      // Select AM synth
      createSynth('AMSynth');
      updateUI('AMSynth');

      await Tone.start();
      playChord(['D4', 'F4', 'A4']);
      document.getElementById('status').textContent = 'Soft Pad preset (AM) - Dm';
    });

    document.getElementById('presetBell').addEventListener('click', async () => {
      document.getElementById('oscType').value = 'sine';
      document.getElementById('modIndex').value = 25;
      document.getElementById('fmHarm').value = 5.5;
      document.getElementById('modIndexVal').textContent = '25';
      document.getElementById('fmHarmVal').textContent = '5.5';

      // Select FM synth
      createSynth('FMSynth');
      updateUI('FMSynth');

      await Tone.start();
      playNote('C5');
      document.getElementById('status').textContent = 'Bell Tone preset (FM) - High modulation, non-integer harmonicity';
    });

    // Initialize
    createSynth('Synth');
  </script>
</body>
</html>
