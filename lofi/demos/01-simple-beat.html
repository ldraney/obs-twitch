<!DOCTYPE html>
<html>
<head>
  <title>Simple Beat - Project 1</title>
  <script src="https://unpkg.com/tone@14"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { color: #e94560; margin-bottom: 10px; }
    h2 { color: #4ecdc4; margin-top: 30px; }
    .subtitle { color: #888; margin-bottom: 30px; }

    .section {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    button {
      background: #e94560;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 8px;
      margin: 5px;
      transition: transform 0.1s, background 0.2s;
    }
    button:hover { background: #ff6b6b; transform: scale(1.02); }
    button:active { transform: scale(0.98); }
    button:disabled { background: #444; cursor: not-allowed; transform: none; }
    button.secondary { background: #4ecdc4; }
    button.secondary:hover { background: #6ee7df; }

    #status {
      text-align: center;
      padding: 15px;
      color: #888;
      font-size: 16px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      margin: 15px 0;
    }
    #status.playing {
      color: #4ecdc4;
      background: rgba(78, 205, 196, 0.1);
    }

    .transport-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 20px 0;
    }

    .play-btn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      font-size: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .play-btn.playing { background: #4ecdc4; }

    .controls {
      display: flex;
      align-items: center;
      gap: 15px;
      margin: 15px 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .control {
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .control label {
      color: #888;
      font-size: 12px;
      min-width: 40px;
    }
    .control .value {
      color: #e94560;
      font-weight: bold;
      min-width: 50px;
      text-align: right;
    }
    .control input[type="range"] {
      width: 120px;
      accent-color: #e94560;
    }

    /* Sound indicators */
    .sound-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    .sound-card {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid transparent;
      transition: all 0.1s;
    }
    .sound-card.active {
      border-color: #4ecdc4;
      background: rgba(78, 205, 196, 0.1);
    }
    .sound-card.playing {
      border-color: #ffd700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
    }
    .sound-card.muted {
      opacity: 0.5;
    }
    .sound-card.muted .icon {
      filter: grayscale(1);
    }

    .sound-card .icon {
      font-size: 40px;
      margin-bottom: 10px;
      transition: transform 0.1s;
    }
    .sound-card.playing .icon {
      transform: scale(1.2);
    }

    .sound-card .name {
      font-weight: bold;
      color: #eee;
      margin-bottom: 5px;
    }
    .sound-card .desc {
      font-size: 12px;
      color: #888;
      margin-bottom: 15px;
    }

    .toggle-btn {
      background: rgba(78, 205, 196, 0.2);
      border: 1px solid #4ecdc4;
      color: #4ecdc4;
      padding: 8px 16px;
      font-size: 12px;
      border-radius: 20px;
    }
    .toggle-btn:hover {
      background: rgba(78, 205, 196, 0.3);
    }
    .toggle-btn.off {
      background: rgba(255, 255, 255, 0.1);
      border-color: #666;
      color: #888;
    }

    /* Code section */
    .code-section {
      margin-top: 30px;
    }
    .code-toggle {
      background: rgba(0,0,0,0.3);
      border: 1px solid #444;
      color: #888;
      padding: 10px 20px;
      width: 100%;
      text-align: left;
      cursor: pointer;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .code-toggle:hover {
      background: rgba(0,0,0,0.4);
      border-color: #666;
    }
    .code-toggle .arrow {
      transition: transform 0.2s;
    }
    .code-toggle.open .arrow {
      transform: rotate(180deg);
    }

    .code-content {
      display: none;
      background: rgba(0,0,0,0.4);
      border: 1px solid #444;
      border-top: none;
      border-radius: 0 0 8px 8px;
      padding: 20px;
      overflow-x: auto;
    }
    .code-content.open {
      display: block;
    }

    pre {
      margin: 0;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      line-height: 1.5;
      color: #ddd;
    }
    .comment { color: #6a9955; }
    .keyword { color: #569cd6; }
    .string { color: #ce9178; }
    .number { color: #b5cea8; }

    .info-box {
      background: rgba(78, 205, 196, 0.1);
      border-left: 4px solid #4ecdc4;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Project 1: Simple Beat</h1>
    <p class="subtitle">Your first lofi beat - kick, hi-hat, and chord</p>

    <div id="status">Click Play to start the beat</div>

    <div class="section">
      <h2>Transport</h2>

      <div class="transport-buttons">
        <button class="play-btn" id="playBtn">&#9658;</button>
      </div>

      <div class="controls">
        <div class="control">
          <label>BPM</label>
          <input type="range" id="bpm" min="60" max="100" value="75">
          <span class="value" id="bpmVal">75</span>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Sounds</h2>
      <p>Toggle each sound on or off. Watch them light up when they play!</p>

      <div class="sound-grid">
        <div class="sound-card" id="kickCard">
          <div class="icon">&#128165;</div>
          <div class="name">Kick</div>
          <div class="desc">MembraneSynth - Beats 1 & 3</div>
          <button class="toggle-btn" id="kickToggle">ON</button>
        </div>

        <div class="sound-card" id="hihatCard">
          <div class="icon">&#129529;</div>
          <div class="name">Hi-Hat</div>
          <div class="desc">NoiseSynth - Every 8th note</div>
          <button class="toggle-btn" id="hihatToggle">ON</button>
        </div>

        <div class="sound-card" id="chordCard">
          <div class="icon">&#127926;</div>
          <div class="name">Chord</div>
          <div class="desc">PolySynth - Cmaj7 sustained</div>
          <button class="toggle-btn" id="chordToggle">ON</button>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Sound Tests</h2>
      <p>Click to hear each sound individually:</p>

      <div class="controls" style="justify-content: center;">
        <button id="testKick">Test Kick</button>
        <button id="testHihat" class="secondary">Test Hi-Hat</button>
        <button id="testChord" style="background: #9b59b6;">Test Chord</button>
      </div>
    </div>

    <div class="info-box">
      <strong>What is happening:</strong>
      <ul style="margin: 10px 0; padding-left: 20px; color: #aaa;">
        <li><strong>Kick</strong> uses MembraneSynth - a synth that simulates a drum membrane with pitch decay</li>
        <li><strong>Hi-Hat</strong> uses NoiseSynth - filtered white noise with a very short envelope</li>
        <li><strong>Chord</strong> uses PolySynth - plays C3, E3, G3, B3 together (Cmaj7)</li>
        <li><strong>Tone.Loop</strong> repeats each pattern at the right interval</li>
        <li><strong>Transport</strong> keeps everything synchronized at the same tempo</li>
      </ul>
    </div>

    <div class="section code-section">
      <button class="code-toggle" id="codeToggle">
        <span>View Code</span>
        <span class="arrow">&#9660;</span>
      </button>
      <div class="code-content" id="codeContent">
<pre><span class="comment">// === SETUP SOUNDS ===</span>

<span class="comment">// Kick drum</span>
<span class="keyword">const</span> kick = <span class="keyword">new</span> Tone.MembraneSynth({
  pitchDecay: <span class="number">0.05</span>,
  octaves: <span class="number">4</span>,
  envelope: {
    attack: <span class="number">0.001</span>,
    decay: <span class="number">0.4</span>,
    sustain: <span class="number">0</span>,
    release: <span class="number">0.4</span>
  }
}).toDestination();
kick.volume.value = <span class="number">-6</span>;

<span class="comment">// Hi-hat</span>
<span class="keyword">const</span> hihat = <span class="keyword">new</span> Tone.NoiseSynth({
  noise: { type: <span class="string">'white'</span> },
  envelope: {
    attack: <span class="number">0.001</span>,
    decay: <span class="number">0.08</span>,
    sustain: <span class="number">0</span>,
    release: <span class="number">0.05</span>
  }
}).toDestination();
hihat.volume.value = <span class="number">-12</span>;

<span class="comment">// Chord synth</span>
<span class="keyword">const</span> chordSynth = <span class="keyword">new</span> Tone.PolySynth(Tone.Synth, {
  oscillator: { type: <span class="string">'triangle'</span> },
  envelope: {
    attack: <span class="number">0.3</span>,
    decay: <span class="number">0.5</span>,
    sustain: <span class="number">0.8</span>,
    release: <span class="number">2</span>
  }
}).toDestination();
chordSynth.volume.value = <span class="number">-10</span>;

<span class="comment">// === SETUP TEMPO ===</span>
Tone.Transport.bpm.value = <span class="number">75</span>;

<span class="comment">// === SETUP LOOPS ===</span>
<span class="keyword">const</span> kickLoop = <span class="keyword">new</span> Tone.Loop((time) => {
  kick.triggerAttackRelease(<span class="string">'C1'</span>, <span class="string">'8n'</span>, time);
}, <span class="string">'2n'</span>);

<span class="keyword">const</span> hihatLoop = <span class="keyword">new</span> Tone.Loop((time) => {
  hihat.triggerAttackRelease(<span class="string">'16n'</span>, time);
}, <span class="string">'8n'</span>);

<span class="keyword">const</span> chordLoop = <span class="keyword">new</span> Tone.Loop((time) => {
  chordSynth.triggerAttackRelease(
    [<span class="string">'C3'</span>, <span class="string">'E3'</span>, <span class="string">'G3'</span>, <span class="string">'B3'</span>],
    <span class="string">'1n'</span>,
    time
  );
}, <span class="string">'1m'</span>);

<span class="comment">// === START ===</span>
kickLoop.start(<span class="number">0</span>);
hihatLoop.start(<span class="number">0</span>);
chordLoop.start(<span class="number">0</span>);

<span class="keyword">await</span> Tone.start();
Tone.Transport.start();</pre>
      </div>
    </div>
  </div>

  <script>
    // State
    let isPlaying = false;
    let isInitialized = false;
    let kickEnabled = true;
    let hihatEnabled = true;
    let chordEnabled = true;

    // Synths
    let kick, hihat, chordSynth;
    let kickLoop, hihatLoop, chordLoop;

    // Initialize sounds - MUST be called after Tone.start()
    async function initSounds() {
      if (isInitialized) return;

      await Tone.start();

      // Kick drum
      kick = new Tone.MembraneSynth({
        pitchDecay: 0.05,
        octaves: 4,
        envelope: {
          attack: 0.001,
          decay: 0.4,
          sustain: 0,
          release: 0.4
        }
      }).toDestination();
      kick.volume.value = -6;

      // Hi-hat
      hihat = new Tone.NoiseSynth({
        noise: { type: 'white' },
        envelope: {
          attack: 0.001,
          decay: 0.08,
          sustain: 0,
          release: 0.05
        }
      }).toDestination();
      hihat.volume.value = -12;

      // Chord synth
      chordSynth = new Tone.PolySynth(Tone.Synth, {
        oscillator: { type: 'triangle' },
        envelope: {
          attack: 0.3,
          decay: 0.5,
          sustain: 0.8,
          release: 2
        }
      }).toDestination();
      chordSynth.volume.value = -10;

      isInitialized = true;
    }

    // Initialize loops
    function initLoops() {
      // Kick loop - every half note (beats 1 and 3)
      kickLoop = new Tone.Loop((time) => {
        if (kickEnabled) {
          kick.triggerAttackRelease('C1', '8n', time);
          // Visual feedback
          Tone.Draw.schedule(() => {
            flashCard('kickCard');
          }, time);
        }
      }, '2n');

      // Hi-hat loop - every 8th note
      hihatLoop = new Tone.Loop((time) => {
        if (hihatEnabled) {
          hihat.triggerAttackRelease('16n', time);
          // Visual feedback
          Tone.Draw.schedule(() => {
            flashCard('hihatCard');
          }, time);
        }
      }, '8n');

      // Chord loop - every measure
      chordLoop = new Tone.Loop((time) => {
        if (chordEnabled) {
          chordSynth.triggerAttackRelease(['C3', 'E3', 'G3', 'B3'], '1n', time);
          // Visual feedback
          Tone.Draw.schedule(() => {
            flashCard('chordCard');
          }, time);
        }
      }, '1m');

      kickLoop.start(0);
      hihatLoop.start(0);
      chordLoop.start(0);
    }

    // Flash visual feedback
    function flashCard(cardId) {
      const card = document.getElementById(cardId);
      card.classList.add('playing');
      setTimeout(() => card.classList.remove('playing'), 100);
    }

    // Toggle playback
    async function togglePlay() {
      await initSounds();

      if (!kickLoop) {
        initLoops();
      }

      if (isPlaying) {
        Tone.Transport.stop();
        Tone.Transport.position = 0;
        isPlaying = false;
        document.getElementById('playBtn').innerHTML = '&#9658;';
        document.getElementById('playBtn').classList.remove('playing');
        document.getElementById('status').textContent = 'Stopped';
        document.getElementById('status').classList.remove('playing');
      } else {
        Tone.Transport.start();
        isPlaying = true;
        document.getElementById('playBtn').innerHTML = '&#9632;';
        document.getElementById('playBtn').classList.add('playing');
        document.getElementById('status').textContent = 'Playing at ' + Tone.Transport.bpm.value + ' BPM';
        document.getElementById('status').classList.add('playing');
      }
    }

    // Toggle individual sounds
    function toggleSound(sound) {
      const card = document.getElementById(sound + 'Card');
      const btn = document.getElementById(sound + 'Toggle');

      if (sound === 'kick') {
        kickEnabled = !kickEnabled;
        card.classList.toggle('muted', !kickEnabled);
        btn.textContent = kickEnabled ? 'ON' : 'OFF';
        btn.classList.toggle('off', !kickEnabled);
      } else if (sound === 'hihat') {
        hihatEnabled = !hihatEnabled;
        card.classList.toggle('muted', !hihatEnabled);
        btn.textContent = hihatEnabled ? 'ON' : 'OFF';
        btn.classList.toggle('off', !hihatEnabled);
      } else if (sound === 'chord') {
        chordEnabled = !chordEnabled;
        card.classList.toggle('muted', !chordEnabled);
        btn.textContent = chordEnabled ? 'ON' : 'OFF';
        btn.classList.toggle('off', !chordEnabled);
      }
    }

    // Event listeners
    function setupEventListeners() {
      // Play/Stop
      document.getElementById('playBtn').addEventListener('click', togglePlay);

      // BPM
      document.getElementById('bpm').addEventListener('input', (e) => {
        const val = parseInt(e.target.value);
        document.getElementById('bpmVal').textContent = val;
        Tone.Transport.bpm.value = val;
        if (isPlaying) {
          document.getElementById('status').textContent = 'Playing at ' + val + ' BPM';
        }
      });

      // Sound toggles
      document.getElementById('kickToggle').addEventListener('click', () => toggleSound('kick'));
      document.getElementById('hihatToggle').addEventListener('click', () => toggleSound('hihat'));
      document.getElementById('chordToggle').addEventListener('click', () => toggleSound('chord'));

      // Test buttons
      document.getElementById('testKick').addEventListener('click', async () => {
        await initSounds();
        kick.triggerAttackRelease('C1', '8n');
        flashCard('kickCard');
      });

      document.getElementById('testHihat').addEventListener('click', async () => {
        await initSounds();
        hihat.triggerAttackRelease('16n');
        flashCard('hihatCard');
      });

      document.getElementById('testChord').addEventListener('click', async () => {
        await initSounds();
        chordSynth.triggerAttackRelease(['C3', 'E3', 'G3', 'B3'], '1n');
        flashCard('chordCard');
      });

      // Code toggle
      document.getElementById('codeToggle').addEventListener('click', () => {
        const toggle = document.getElementById('codeToggle');
        const content = document.getElementById('codeContent');
        toggle.classList.toggle('open');
        content.classList.toggle('open');
      });
    }

    // Initialize - only set up event listeners at page load
    // Sounds and loops are created on first user interaction
    function init() {
      setupEventListeners();
      Tone.Transport.bpm.value = 75;
    }

    init();
  </script>
</body>
</html>
