<!DOCTYPE html>
<html>
<head>
  <style>
    * { margin: 0; padding: 0; }
    body { background: transparent; overflow: hidden; font-family: sans-serif; }
    canvas { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; }
    #text {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      text-align: center; opacity: 0; z-index: 100;
    }
    #text.show { animation: pop 0.5s forwards; }
    #text.hide { animation: unpop 0.5s forwards; }
    @keyframes pop { 0% { transform: translate(-50%,-50%) scale(0); opacity: 0; } 100% { transform: translate(-50%,-50%) scale(1); opacity: 1; } }
    @keyframes unpop { 0% { transform: translate(-50%,-50%) scale(1); opacity: 1; } 100% { transform: translate(-50%,-50%) scale(0); opacity: 0; } }
    .yay { font-size: 80px; font-weight: 900; color: #fff; text-shadow: 0 0 20px #9146ff, 0 0 40px #ff00ff, 3px 3px #000; }
    .name { font-size: 50px; color: #0ff; text-shadow: 0 0 20px #0ff, 2px 2px #000; }
    .sub { font-size: 28px; color: #fff; margin-top: 10px; }
    #status { position: fixed; bottom: 10px; right: 10px; padding: 5px 10px; background: rgba(0,0,0,0.5); color: #fff; border-radius: 10px; font-size: 12px; }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div id="text">
    <div class="yay">YAAAAAY!</div>
    <div class="name" id="name"></div>
    <div class="sub">just followed!</div>
  </div>
  <div id="status">...</div>

  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const textEl = document.getElementById('text');
    const nameEl = document.getElementById('name');
    const statusEl = document.getElementById('status');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };

    const colors = ['#9146FF','#FF6B9D','#00FFFF','#FFD700','#FF4500','#00FF7F','#FF1493','#FFF'];
    let particles = [];

    function celebrate(username) {
      nameEl.textContent = username;
      textEl.classList.remove('hide');
      textEl.classList.add('show');

      // Spawn confetti
      for (let i = 0; i < 200; i++) {
        setTimeout(() => {
          particles.push({
            x: Math.random() * canvas.width,
            y: -20,
            vx: (Math.random() - 0.5) * 5,
            vy: Math.random() * 3 + 2,
            size: Math.random() * 15 + 8,
            color: colors[Math.floor(Math.random() * colors.length)],
            rot: Math.random() * 360,
            rotSpeed: (Math.random() - 0.5) * 10,
            life: 1
          });
        }, i * 10);
      }

      animate();

      setTimeout(() => {
        textEl.classList.remove('show');
        textEl.classList.add('hide');
      }, 4000);
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      particles = particles.filter(p => {
        p.y += p.vy;
        p.vy += 0.1;
        p.x += p.vx;
        p.rot += p.rotSpeed;
        if (p.y > canvas.height - 100) p.life -= 0.02;

        if (p.life > 0) {
          ctx.save();
          ctx.globalAlpha = p.life;
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot * Math.PI / 180);
          ctx.fillStyle = p.color;
          ctx.fillRect(-p.size/2, -p.size/4, p.size, p.size/2);
          ctx.restore();
          return true;
        }
        return false;
      });

      if (particles.length > 0) requestAnimationFrame(animate);
    }

    // WebSocket
    function connect() {
      const ws = new WebSocket('ws://localhost:8080');
      ws.onopen = () => { statusEl.textContent = 'âœ“ Connected'; statusEl.style.background = 'green'; };
      ws.onmessage = (e) => {
        const d = JSON.parse(e.data);
        if (d.type === 'follow' || d.type === 'test') celebrate(d.username || 'Someone');
        if (d.type === 'raid') celebrate(d.username + ' RAID!');
        if (d.type === 'subscribe') celebrate(d.username + ' SUBBED!');
      };
      ws.onclose = () => { statusEl.textContent = 'Reconnecting...'; statusEl.style.background = 'red'; setTimeout(connect, 2000); };
      ws.onerror = () => {};
    }
    connect();

    // Keyboard test
    document.onkeydown = (e) => { if (e.key === 'f' || e.key === 'F') celebrate('TestUser_' + Math.floor(Math.random()*999)); };
  </script>
</body>
</html>
